@using System.Text.RegularExpressions
@using BlazorServerApp.WordsAPI
@using Newtonsoft.Json
@using BlazorServerApp.STMPMailer
@inject IRecipeDataLoader dataLoader
@inject IConfiguration config
@inject IHttpClientFactory httpClientFactory
@inject IEmailSender sender
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Mvc.Rendering

@page "/dev"


<btn class="btn btn-primary" @onclick="RunTask1">Run Task1</btn>
<btn class="btn btn-primary" @onclick="RunTask2">Run Task2</btn>

@code{
    Dictionary<string, Task<string>> taskDictionary = new();

    async void RunTask2()
    {
        Console.WriteLine("task2 started");
        if (taskDictionary.ContainsKey("task1"))
        {
            Console.WriteLine(await taskDictionary["task1"]);
        }
        else
        {
            Console.WriteLine("task not in dict.");
        }
        Console.WriteLine("task2 finished");
    }

    async void RunTask1()
    {
        Console.WriteLine("task1 started");
        Task<string> task = DoHeavyComputationLastingManySeconds();
        taskDictionary.Add("task1", task);
        await task; 
        Console.WriteLine(task.Result);
        taskDictionary.Remove("task1");
        Console.WriteLine("task1 finished");
    }

    async Task<string> DoHeavyComputationLastingManySeconds()
    {
        await Task.Delay(5000);
        return "cheese";
    }
}